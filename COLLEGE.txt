CREATE TABLE STUDENT
(
	USN NUMBER(5),
	S_NAME VARCHAR(10),
	ADDRESS VARCHAR(20),
	PHONE NUMBER(5),
	GENDER VARCHAR(10),
	PRIMARY KEY(USN)
);

CREATE TABLE SEM_SEC
(
	SSID NUMBER(5),
	SEM NUMBER(1),
	SEC VARCHAR(5),
	PRIMARY KEY(SSID)
);

CREATE TABLE CLASS
(
	USN NUMBER(5),
	SSID NUMBER(5),
	FOREIGN KEY(USN) REFERENCES STUDENT(USN),
	FOREIGN KEY(SSID) REFERENCES SEM_SEC(SSID)
);

CREATE TABLE SUBJECTS
(
	SUBCODE NUMBER(5),
	TITLE VARCHAR(20),
	SEM NUMBER(1),
	CREDITS NUMBER(5),
	PRIMARY KEY(SUBCODE)
);

CREATE TABLE MARKS
(
	USN NUMBER(5),
	SUBCODE NUMBER(5),
	SSID NUMBER(5),
	TEST1 NUMBER(5),
	TEST2 NUMBER(5),
	TEST3 NUMBER(5),
	FOREIGN KEY(USN) REFERENCES STUDENT(USN),
	FOREIGN KEY(SSID) REFERENCES SEM_SEC(SSID),
	FOREIGN KEY(SUBCODE) REFERENCES SUBJECTS(SUBCODE)
);

INSERT INTO STUDENT VALUES(11,'SAM','INDIRANAGAR',231432,'FEMALE');
INSERT INTO STUDENT VALUES(22,'AYMAN','INDIRANAGAR',231232,'MALE');
INSERT INTO STUDENT VALUES(33,'TANYA','WHITE FIELD',231443,'FEMALE');
INSERT INTO STUDENT VALUES(44,'DISHA','RR NAGAR',231213,'FEMALE');
INSERT INTO STUDENT VALUES(55,'SHAAN','MG ROAD',212543,'MALE');

INSERT INTO SEM_SEC VALUES(1,2,'B');
INSERT INTO SEM_SEC VALUES(2,6,'B');
INSERT INTO SEM_SEC VALUES(3,4,'A');
INSERT INTO SEM_SEC VALUES(4,4,'C');
INSERT INTO SEM_SEC VALUES(5,4,'B');

INSERT INTO CLASS VALUES(11,4);
INSERT INTO CLASS VALUES(33,5);
INSERT INTO CLASS VALUES(44,4);
INSERT INTO CLASS VALUES(55,2);
INSERT INTO CLASS VALUES(22,4);

INSERT INTO SUBJECTS VALUES(10,'MP',4,4);
INSERT INTO SUBJECTS VALUES(20,'DBMS',2,4);
INSERT INTO SUBJECTS VALUES(30,'LD',5,3);
INSERT INTO SUBJECTS VALUES(40,'ADA',1,4);
INSERT INTO SUBJECTS VALUES(50,'COA',3,3);

INSERT INTO MARKS VALUES(44,10,4,10,12,11);
INSERT INTO MARKS VALUES(22,50,4,16,15,12);
INSERT INTO MARKS VALUES(33,10,5,19,19,20);
INSERT INTO MARKS VALUES(11,20,4,15,14,13);
INSERT INTO MARKS VALUES(55,30,2,19,19,19);
INSERT INTO MARKS VALUES(22,40,4,12,18,16);

SELECT * FROM STUDENT S WHERE S.USN IN (SELECT C.USN FROM CLASS C,SEM_SEC S WHERE S.SSID=C.SSID AND S.SEM=4 AND S.SEC='C');

SELECT SS.SEM,SS.SEC,COUNT(*) AS TOTAL_STUDENT FROM SEM_SEC SS,CLASS C WHERE C.SSID=SS.SSID GROUP BY SS.SSID;

SELECT SEM,SEC,COUNT(GENDER) AS FEMALE FROM (STUDENT NATURAL JOIN CLASS) RIGHT OUTER JOIN SEM_SEC ON CLASS.SSID=SEM_SEC.SSID WHERE GENDER="FEMALE" GROUP BY (SEM_SEC.SSID);

SELECT SEM,SEC,COUNT(GENDER) AS MALE FROM (STUDENT NATURAL JOIN CLASS) RIGHT OUTER JOIN SEM_SEC ON CLASS.SSID=SEM_SEC.SSID WHERE GENDER="MALE" GROUP BY (SEM_SEC.SSID);

CREATE VIEW USN_22(USN,SUB,MARKS) AS SELECT M.USN,S.TITLE,M.TEST1 FROM MARKS M,SUBJECTS S WHERE M.SUBCODE=S.SUBCODE AND M.USN=22;
SELECT * FROM USN_22;

ALTER TABLE MARKS ADD COLUMN FINAL_ALL FLOAT;
UPDATE MARKS SET FINAL_ALL=((TEST1+TEST2+TEST3)-LEAST(TEST1,TEST2,TEST3))/2;
SELECT * FROM MARKS;

ALTER TABLE MARKS ADD COLUMN CATEGORY VARCHAR(20);
UPDATE MARKS SET CATEGORY= 
CASE 
WHEN FINAL_ALL>=17 AND FINAL_ALL<=20 THEN 'OUSTANDING'
WHEN FINAL_ALL>=12 AND FINAL_ALL<17 THEN 'AVERAGE'
WHEN FINAL_ALL<12 THEN 'WEAK'
END;
SELECT * FROM MARKS;